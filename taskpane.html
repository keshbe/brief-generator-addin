<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Brief Generator</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <!-- Bootstrap f√ºr sch√∂nes Design -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 10px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 100%;
            padding: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .btn-primary {
            background-color: #0078d4;
            border-color: #0078d4;
        }
        .btn-primary:hover {
            background-color: #106ebe;
            border-color: #106ebe;
        }
        .card {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: none;
        }
        .card-header {
            background-color: #0078d4;
            color: white;
            font-weight: bold;
        }
        #status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            display: none;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .standort-preview {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.85em;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">üìù Brief Generator Pro</h4>
            </div>
            <div class="card-body">
                <form id="briefForm">
                    <!-- Standort Auswahl -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="standort" class="form-label">Standort *</label>
                                <select class="form-control" id="standort" required>
                                    <option value="">-- Standort ausw√§hlen --</option>
                                    <option value="zuerich">üè¢ Z√ºrich Hauptsitz</option>
                                    <option value="basel">üè≠ Basel Niederlassung</option>
                                    <option value="bern">üèõÔ∏è Bern B√ºro</option>
                                </select>
                                <div id="standortPreview" class="standort-preview"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="absenderName" class="form-label">Absender Name *</label>
                                <input type="text" class="form-control" id="absenderName" required>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Empf√§nger Daten -->
                    <h5 class="mb-3">üìÆ Empf√§nger</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="empfaengerName" class="form-label">Empf√§nger Name *</label>
                                <input type="text" class="form-control" id="empfaengerName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="empfaengerFirma" class="form-label">Firma</label>
                                <input type="text" class="form-control" id="empfaengerFirma">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="empfaengerStrasse" class="form-label">Stra√üe</label>
                                <input type="text" class="form-control" id="empfaengerStrasse">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="empfaengerOrt" class="form-label">PLZ / Ort</label>
                                <input type="text" class="form-control" id="empfaengerOrt">
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Brief Inhalt -->
                    <h5 class="mb-3">‚úâÔ∏è Brief Inhalt</h5>
                    <div class="form-group">
                        <label for="betreff" class="form-label">Betreff *</label>
                        <input type="text" class="form-control" id="betreff" required>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="anrede" class="form-label">Anrede</label>
                                <select class="form-control" id="anrede">
                                    <option value="Sehr geehrte Damen und Herren">Sehr geehrte Damen und Herren</option>
                                    <option value="Sehr geehrte Frau">Sehr geehrte Frau</option>
                                    <option value="Sehr geehrter Herr">Sehr geehrter Herr</option>
                                    <option value="Liebe">Liebe</option>
                                    <option value="Lieber">Lieber</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="gruss" class="form-label">Gru√üformel</label>
                                <select class="form-control" id="gruss">
                                    <option value="Mit freundlichen Gr√º√üen">Mit freundlichen Gr√º√üen</option>
                                    <option value="Mit besten Gr√º√üen">Mit besten Gr√º√üen</option>
                                    <option value="Hochachtungsvoll">Hochachtungsvoll</option>
                                    <option value="Viele Gr√º√üe">Viele Gr√º√üe</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="brieftext" class="form-label">Brieftext *</label>
                        <textarea class="form-control" id="brieftext" rows="6" required 
                                  placeholder="Geben Sie hier den Inhalt Ihres Briefes ein..."></textarea>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            üìÑ Professionellen Brief erstellen
                        </button>
                    </div>
                </form>

                <div id="status"></div>
            </div>
        </div>
    </div>

    <script>
        // Standort-Konfigurationen
        const standortConfig = {
            zuerich: {
                name: "KSH Z√ºrich AG",
                adresse: "Bahnhofstrasse 123\n8001 Z√ºrich\nSchweiz",
                telefon: "+41 44 123 45 67",
                email: "info@ksh-zuerich.ch",
                web: "www.ksh-zuerich.ch",
                iban: "CH93 0076 2011 6238 5295 7",
                uid: "CHE-123.456.789",
                headerColor: "#0078d4",
                logo: "üè¢"
            },
            basel: {
                name: "KSH Basel GmbH",
                adresse: "Steinenring 456\n4001 Basel\nSchweiz", 
                telefon: "+41 61 987 65 43",
                email: "basel@ksh-gruppe.ch",
                web: "www.ksh-basel.ch",
                iban: "CH89 0076 2011 6238 5295 8",
                uid: "CHE-987.654.321",
                headerColor: "#d13438",
                logo: "üè≠"
            },
            bern: {
                name: "KSH Bern B√ºro",
                adresse: "Bundesplatz 789\n3001 Bern\nSchweiz",
                telefon: "+41 31 555 44 33", 
                email: "bern@ksh-gruppe.ch",
                web: "www.ksh-bern.ch",
                iban: "CH76 0076 2011 6238 5295 9",
                uid: "CHE-555.444.333",
                headerColor: "#28a745",
                logo: "üèõÔ∏è"
            }
        };

        // Office.js Initialisierung
        Office.onReady((info) => {
            if (info.host === Office.HostType.Word) {
                console.log('Word Add-In ist bereit');
                document.getElementById('briefForm').addEventListener('submit', erstelleBrief);
                document.getElementById('standort').addEventListener('change', showStandortPreview);
            } else {
                showStatus('Dieses Add-In funktioniert nur in Microsoft Word', 'error');
            }
        });

        // Standort-Vorschau anzeigen
        function showStandortPreview() {
            const standort = document.getElementById('standort').value;
            const previewDiv = document.getElementById('standortPreview');
            
            if (standort && standortConfig[standort]) {
                const config = standortConfig[standort];
                previewDiv.innerHTML = `
                    <strong>${config.logo} ${config.name}</strong><br>
                    <small>${config.adresse.split('\n').join(', ')}<br>
                    Tel: ${config.telefon} | E-Mail: ${config.email}</small>
                `;
                previewDiv.style.display = 'block';
            } else {
                previewDiv.style.display = 'none';
            }
        }

        // Status anzeigen
        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status-${type}`;
            statusElement.style.display = 'block';
            
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }

        // Hauptfunktion: Brief erstellen
        async function erstelleBrief(event) {
            event.preventDefault();
            
            try {
                showStatus('Brief wird erstellt...', 'info');
                
                // Formulardaten sammeln
                const formData = {
                    standort: document.getElementById('standort').value,
                    absenderName: document.getElementById('absenderName').value,
                    empfaengerName: document.getElementById('empfaengerName').value,
                    empfaengerFirma: document.getElementById('empfaengerFirma').value,
                    empfaengerStrasse: document.getElementById('empfaengerStrasse').value,
                    empfaengerOrt: document.getElementById('empfaengerOrt').value,
                    betreff: document.getElementById('betreff').value,
                    anrede: document.getElementById('anrede').value,
                    brieftext: document.getElementById('brieftext').value,
                    gruss: document.getElementById('gruss').value
                };

                // Validation
                if (!formData.standort || !formData.absenderName || !formData.empfaengerName || !formData.betreff || !formData.brieftext) {
                    showStatus('Bitte f√ºllen Sie alle Pflichtfelder (*) aus', 'error');
                    return;
                }

                const config = standortConfig[formData.standort];

                // Word-Dokument erstellen
                await Word.run(async (context) => {
                    // Dokument leeren
                    context.document.body.clear();
                    
                    // === HEADER ERSTELLEN ===
                    const headerRange = context.document.sections.getFirst().getHeader(Word.HeaderFooterType.primary);
                    headerRange.clear();
                    
                    // Header-Tabelle f√ºr Layout
                    const headerTable = headerRange.insertTable(2, 2, Word.InsertLocation.start);
                    headerTable.getBorder(Word.BorderLocation.all).type = Word.BorderType.none;
                    
                    // Firmenlogo und Name (gro√üe Zelle oben links)
                    const logoCell = headerTable.getCell(0, 0);
                    const logoParagraph = logoCell.body.insertParagraph(`${config.logo} ${config.name}`, Word.InsertLocation.start);
                    logoParagraph.font.size = 20;
                    logoParagraph.font.bold = true;
                    logoParagraph.font.color = config.headerColor;
                    
                    // Kontakt-Info (oben rechts)
                    const kontaktCell = headerTable.getCell(0, 1);
                    const kontaktText = `Tel: ${config.telefon}\nE-Mail: ${config.email}\nWeb: ${config.web}`;
                    const kontaktParagraph = kontaktCell.body.insertParagraph(kontaktText, Word.InsertLocation.start);
                    kontaktParagraph.font.size = 10;
                    kontaktParagraph.alignment = Word.Alignment.right;
                    
                    // Adresse (unten links)
                    const adressCell = headerTable.getCell(1, 0);
                    const adressParagraph = adressCell.body.insertParagraph(config.adresse, Word.InsertLocation.start);
                    adressParagraph.font.size = 10;
                    
                    // Leere Zelle unten rechts f√ºr Layout
                    const emptyCell = headerTable.getCell(1, 1);
                    emptyCell.body.insertParagraph("", Word.InsertLocation.start);
                    
                    // Header-Abstand
                    headerRange.insertParagraph("", Word.InsertLocation.end);
                    
                    // === BRIEF-INHALT ===
                    
                    // Datum mit Standort (rechtsb√ºndig)
                    const datumParagraph = context.document.body.insertParagraph(
                        `${config.name.split(' ')[1]}, ${new Date().toLocaleDateString('de-CH', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}`, 
                        Word.InsertLocation.end
                    );
                    datumParagraph.alignment = Word.Alignment.right;
                    datumParagraph.spaceAfter = 36;

                    // Empf√§nger-Adresse
                    const empfaengerText = [
                        formData.empfaengerName,
                        formData.empfaengerFirma,
                        formData.empfaengerStrasse,
                        formData.empfaengerOrt
                    ].filter(line => line && line.trim()).join('\n');
                    
                    const empfaengerParagraph = context.document.body.insertParagraph(empfaengerText, Word.InsertLocation.end);
                    empfaengerParagraph.spaceAfter = 36;

                    // Betreff (fett und mit Farbe)
                    const betreffParagraph = context.document.body.insertParagraph(`Betreff: ${formData.betreff}`, Word.InsertLocation.end);
                    betreffParagraph.font.bold = true;
                    betreffParagraph.font.color = config.headerColor;
                    betreffParagraph.spaceAfter = 24;

                    // Anrede
                    let anredeText = formData.anrede;
                    if (formData.anrede.includes('Frau') || formData.anrede.includes('Herr') || formData.anrede.includes('Liebe') || formData.anrede.includes('Lieber')) {
                        const vorname = formData.empfaengerName.split(' ')[0];
                        anredeText += ` ${vorname}`;
                    }
                    anredeText += ',';
                    
                    const anredeParagraph = context.document.body.insertParagraph(anredeText, Word.InsertLocation.end);
                    anredeParagraph.spaceAfter = 12;

                    // Brieftext (mit Blocksatz)
                    const brieftextParagraph = context.document.body.insertParagraph(formData.brieftext, Word.InsertLocation.end);
                    brieftextParagraph.spaceAfter = 24;
                    brieftextParagraph.alignment = Word.Alignment.justified;

                    // Gru√üformel
                    const grussParagraph = context.document.body.insertParagraph(formData.gruss, Word.InsertLocation.end);
                    grussParagraph.spaceAfter = 60; // Platz f√ºr Unterschrift

                    // Unterschriftszeile
                    const unterschriftParagraph = context.document.body.insertParagraph(formData.absenderName, Word.InsertLocation.end);
                    unterschriftParagraph.spaceAfter = 24;
                    
                    // === FOOTER ERSTELLEN ===
                    const footerRange = context.document.sections.getFirst().getFooter(Word.HeaderFooterType.primary);
                    footerRange.clear();
                    
                    // Footer-Linie (mit Farbe)
                    const footerLine = footerRange.insertParagraph("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ", Word.InsertLocation.start);
                    footerLine.font.color = config.headerColor;
                    footerLine.font.size = 8;
                    
                    // Footer-Tabelle f√ºr Firmeninformationen
                    const footerTable = footerRange.insertTable(1, 3, Word.InsertLocation.end);
                    footerTable.getBorder(Word.BorderLocation.all).type = Word.BorderType.none;
                    
                    // Adress-Spalte
                    const footerAdressCell = footerTable.getCell(0, 0);
                    const footerAdressParagraph = footerAdressCell.body.insertParagraph(`Adresse:\n${config.adresse}`, Word.InsertLocation.start);
                    footerAdressParagraph.font.size = 8;
                    
                    // Kontakt-Spalte  
                    const footerKontaktCell = footerTable.getCell(0, 1);
                    const footerKontaktText = `Kontakt:\nTel: ${config.telefon}\nE-Mail: ${config.email}\nWeb: ${config.web}`;
                    const footerKontaktParagraph = footerKontaktCell.body.insertParagraph(footerKontaktText, Word.InsertLocation.start);
                    footerKontaktParagraph.font.size = 8;
                    
                    // Banking-Spalte
                    const footerBankingCell = footerTable.getCell(0, 2);
                    const footerBankingText = `Banking:\nIBAN: ${config.iban}\nUID: ${config.uid}`;
                    const footerBankingParagraph = footerBankingCell.body.insertParagraph(footerBankingText, Word.InsertLocation.start);
                    footerBankingParagraph.font.size = 8;

                    // √Ñnderungen synchronisieren
                    await context.sync();
                });

                showStatus('Professioneller Brief wurde erfolgreich erstellt!', 'success');
                
            } catch (error) {
                console.error('Fehler beim Erstellen des Briefes:', error);
                showStatus('Fehler beim Erstellen des Briefes: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
